---
layout: post
title: 二维码登录的本质
---

> **前置知识**
>
> **一维码**(条形码)其实代表的就是一串数字
>
> **二维码**代表的是一个字符串
>
> **设备信息**是唯一的
>
> 平时客户端登录系统的流程如下：客户端将账号密码以及设备信息发送给服务端，服务端验证账号密码之后，将账户ID与设备信息进行绑定，形成一个数据结构，之后再将这个数据结构映射成一个token，传给客户端，之后客户端访问服务端都带着这个token和自己的设备信息，服务端接收到token之后找到与之绑定的设备信息，与传过来的设备信息进行比较，如果相同则调用API返回结果。如果不同，则验证失败重新登录。

> **二维码登录流程**
>
> PC端发送二维码请求和设备信息给服务端，服务端返回二维码ID并且绑定设备信息，PC端根据二维码ID生成二维码，并不断轮询（比如1s）服务端请求二维码当前状态。手机端这时扫描二维码，获取二维码ID，并调用服务端接口将二维码ID和移动端身份信息发送给服务端，然后服务端将身份信息和二维码ID进行绑定生成一个临时token给移动端，这时弹出确认登录界面，PC端二维码状态变成已扫描，这时点击确认登录将临时token发送给服务端，服务端根据绑定的账号信息和设备信息返回给PC端token，这时PC端就可以携带token进行访问了