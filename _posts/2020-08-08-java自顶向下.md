---
layout: post
title: java自顶向下
---

> 当你用java语言写完一段代码后，使用javac xxx.java将源代码编译成xxx.class字节码文件，然后运行指令java xxx.class文件，这时就是用jvm也就是常见的hotspot将字节码文件通过解释或编译的方式成机器码，其中JIT就是将其中热点代码编译成机器码，其余非热点的代码由java虚拟机解释执行。好，到这一步了，下面就是操作系统层级的东西了。开机后，bios会先加载到内存中，然后进行相应的启动操作，最终从磁盘将kernel读取出来，加载到内存当中，内存是由分段机制实现的，内存空间的分段名为ring0，用户空间的内存分段为ring3。当内核加载到内存中后，会开启保护模式，何为保护模式，就是用户空间无法访问内核空间。但内核可以访问用户空间或者硬件。好，这时候你就会想要是java代码里有一个读取磁盘文件或者读取socket信息的操作呢，该如何访问。在linux里，一切对象皆是文件，所以每个你读取的对象都有一个相应的文件描述符。因此此时你必须调用内核中相应的读取磁盘文件的接口，然后内核去磁盘读取文件，或者socket信息，但是由于是保护模式，jvm又属于用户空间，那该怎么去调用内核空间的操作呢，此时就是编译器在编译java代码时，如果遇到了类似的操作，就会在操作前加一个80中断。CPU读取到80中断的时候，就会从用户态切换到内核态，然后执行相应磁盘或者socket信息IO操作，然后将读取到的值返回给用户态