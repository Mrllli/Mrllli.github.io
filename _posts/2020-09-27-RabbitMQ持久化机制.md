---
layout: post
title: RabbitMQ持久化机制
---

> **vhost:一组exchange和对应的Queue**

> **Queue中的消息保存有两种机制，一种是持久化到DISK中，一个是保存在RAM中，什么时候会保存在DISK中呢，分为两种情况，一种是写代码时说明了需要保存在DISK中，一种是内存紧张的时候，部分内存中的数据会被转移到DISK中，存储在DISK中的数据被存储在一个后缀为.rdq的文件中，当超过阈值16MB时，会生成一个新的文件保存，当文件中删除数据比例大于阈值时会发生合并操作。使用RAM方式保存数据，需要集群节点有一个使用DISK保存数据的节点，好进行同步操作，RAM方式效率高，但会有丢失的可能**
>
> **如何保证生产者数据成功到达Queue呢，有两种机制，一种是事务机制，效率太低，一种是确认模式，确认模式就是每条信息有一个特定的ID信息，一旦成功到达Queue，Queue返回一个确认信息，确认信息中包含之前的唯一ID。有普通确认，批量确认，异步确认等机制**
>
> **如何保证Queue数据成功消费者读取呢，有一种模式叫手动回执，就是消费者消费一条信息后需要显示回一个ACK给Queue，如果没有回ACK，Queue把消息发给其它的消费者**
>
> **流控机制：当RabbitMQ服务器内存硬盘资源达到设置阈值的时候，会触发流控机制，降低生产者向Queue发送消息的速率，对RabbitMQ性能有极大影响**