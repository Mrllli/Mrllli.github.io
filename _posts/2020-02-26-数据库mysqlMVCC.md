---
layout: post
title: 数据库mysqlMVCC
---

> 因此在可重复读隔离级别下，数据库是如何实现快照的呢，假如数据库数据好几G，快照是否也为好几G呢？
>
> 事实上数据库通过给每个数据生成版本号，给每个事务也加上事务id，来达成这个目的，假如一个事务的事务id是5，它修改了某一行数据，那这行数据当下版本的id就是5，如果这时候又有一个事务id为10，它修改了这一行数据，当下版本id就为10。
>
> 假设现在有一个活跃的事务id为90，对数据进行修改k=1，现在开启事务A，id为91，事务A会生成一个数组，数组里记录了目前所有活跃事务的id，因此为[90,91]，现在低水位为90，高水位为91+1=92.现在A查询数据k，发现k的id为90，处于低水位中可以被看见。因此查询k=90。这时再开启一个事务id为92，对k修改k=3，这时A再查询k，k当前数据版本号为92，处于高水位不可见，通过回滚日志undoLog到k=1，可以查询到，这时A再对k修改k=2，k版本号为91，这时由于版本号等于自身id，再查询K的时候可以查询到k=2。