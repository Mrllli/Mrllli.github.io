---
layout: post
title: Linux网络
---

> 那么Linux系统是怎么进行网络通信的呢
>
> **发送：**首先应用程序调用**SocketAPI(Sendmsg)**将数据发送到Socket的缓存当中，然后传输层（TCP）在数据头的部分加上一个TCP头，然后在网络层进行分片（如果大于最大传输单元MTU，一般值为1500），分片之后在每一段数据头部加上IP头，然后到数据链路层找到下一跳的MAC地址再对数据加上帧头和帧尾，然后把数据包放入DMA发包队列中，然后软中断通知驱动程序，发包队列中有新的网络帧需要发送，然后驱动程序通过DMA从发包队列中读出网络帧，通过物理网卡将它发送出去
>
> **接收：**当网卡接收到一个网络帧之后，将网络帧放入DMA的环形缓冲队列中，通过硬中断告诉网卡中断程序接收到了网络包，然后网卡中断程序为网络帧分配内核数据结构sk_buff，然后通过软中断告诉内核收到了新的网络帧，然后内核协议栈将缓冲区的网络帧通过网络协议栈从下到上处理这个网络帧，在链路层判断报文合法性，找出上层是IPV4还是IPV6，交给网络层，网络层取出IP头，判断网络包是交给上层处理还是转发，如果是交给上层，再判断上层协议类型，TCP还是UDP，传输层取出TCP或UDP头之后根据Socket四元组找出对应对的Socket，并把数据拷贝到Socket接收缓存当中，然后应用程序就可以通过Socket接口，读取到新的数据了

> **这些缓冲区都处于内核管理的内存当中，且都属于Cache**

